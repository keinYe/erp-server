{% set page_title = "Sales List" %}
{% extends "base.html" %}

{% block stylesheets %}
<style media="screen" type="text/css">
  hr {
    height:2px;
    color:white;
    margin-top: 10px;
    margin-bottom: 5px;
  }

  .center-in-center {
    width: auto;
    height: auto;
    position: absolute;
    padding: 10px 20px 0px 20px;
    left: 50%;
    background-color: white;
    -webkit-transform: translate(-50%, 0%);
    -moz-transform: translate(-50%, 0%);
    -ms-transform: translate(-50%, 0%);
    -o-transform: translate(-50%, 0%);
    transform: translate(-50%, 0%);
  }
  .input-group {
    width: 400px;
    height: 30px;
  }
  .form-control {
    height: inherit;
    font-size: 16px;
  }
  .input-group-addon {
    width: 80px;
  }
  .form-filling {
    height: 10px;
  }
  .submit {
    border-radius: 4px;
    color: #fff;
    width: 100%;
    height: 100%;
    background-color: #3B78DD;
    font-size: 20px;
  }

  .form-red {
    border: 1px solid red;
  }
</style>
{% endblock %}

{% block content %}
<div class="container">
  <label style="font-size:20px;">
    <a href="{{ url_for('sales.list') }}" style="color:black;"> 销售列表 </a>
  </label>
  <label style="font-size:20px;float: right!important;">
    <a href="{{ url_for('sales.add') }}" style="color:black;"> 新增 </a>
  </label>
  <hr>

  <div class="center-in-center">
    <form method="post" action="{{url_for('sales.add')}}" id="add_form">
      <div class="input-group margin-bottom-sm">
        <span class="input-group-addon">设备型号</span>
        <input class="form-control" id="model" type="text" placeholder="设备型号" name="model">
      </div>
      <div class="form-filling"></div>
      <div class="input-group margin-bottom-sm">
        <span class="input-group-addon">数量</span>
        <input class="form-control" id="quantity" type="text" placeholder="数量" name="quantity">
      </div>
      <div class="form-filling"></div>
      <div class="input-group margin-bottom-sm">
        <span class="input-group-addon">申请人</span>
        <input class="form-control" id="applicant" ype="text" placeholder="申请人" name="applicant">
      </div>
      <div class="form-filling"></div>
      <div class="input-group margin-bottom-sm">
        <span class="input-group-addon">代理商</span>
        <input class="form-control" id="agent" type="text" placeholder="代理商" name="agent">
      </div>
      <div class="form-filling"></div>
      <div class="input-group margin-bottom-sm">
        <span class="input-group-addon">联系人</span>
        <input class="form-control" id="contact" type="text" placeholder="联系人" name="contact">
      </div>
      <div class="form-filling"></div>
      <div class="input-group margin-bottom-sm">
        <span class="input-group-addon">地址</span>
        <textarea class="form-control" id="address" name="address" placeholder="请输入地址" form="add_form"></textarea>
        <!-- <input class="form-control" type="text" placeholder="地址" name="address"> -->
      </div>
      <div class="form-filling"></div>
      <div class="input-group margin-bottom-sm">
        <span class="input-group-addon">电话</span>
        <input class="form-control" id="tel" type="text" placeholder="电话" name="tel">
      </div>
      <div class="form-filling "></div>
      <div class="input-group margin-bottom-sm">
        <span class="input-group-addon">备注</span>
        <textarea class="form-control" id="remarks" name="remarks" placeholder="备注" form="add_form"></textarea>
        <!-- <input class="form-control" type="text" placeholder="备注" name="remarks"> -->
      </div>
      <div class="form-filling "></div>
      <div class="input-group">
        <button class="submit" type="submit" name="button" value="login">提&nbsp;&nbsp交</button>
      </div>
      <div class="form-filling"></div>
    </form>
  </div>
</div>

{% endblock %}

{% block script %}
<script type=text/javascript>
  function isNull(val) {
    //去除空格
    console.log(val)
    var str = val.replace(/(^\s*)|(\s*$)/g, '');//把val首尾的空格去掉。

    //空格为 null
    if (str == '' || str == undefined || str == null) {
      console.log("true")
      return true;
    }
    return false;
  };

  function updateState(element) {
    if (isNull(element.value)) {
      element.classList.add('form-red')
      return false
    }
    element.classList.remove('form-red')
    return true
  }

  $(function () {
    $("form").submit( function(event) {
      event.preventDefault();
      var model = document.getElementById('model');
      var quantity = document.getElementById('quantity');
      var applicant = document.getElementById('applicant');
      var contact = document.getElementById('contact');


      var convertTableToJson = function()
      {
          var rows = {
            model: document.getElementById('model').value,
            quantity: document.getElementById('quantity').value,
            applicant: document.getElementById('applicant').value,
            agent: document.getElementById('agent').value,
            contact: document.getElementById('contact').value,
            address: document.getElementById('address').value,
            tel: document.getElementById('tel').value,
            remarks: document.getElementById('remarks').value,
          };
          return JSON.stringify(rows);
      };


      if (updateState(model)
      && updateState(quantity)
      && updateState(applicant)
      && updateState(contact)) {
        $.ajax({
          url: $(this).attr("action"),
          type: 'post',
          dataType: "json",
          contentType: "application/json",
          data: convertTableToJson(),
          beforeSend: function(xhr, settings) {
            // if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type)) {
            //   xhr.setRequestHeader("X-CSRFToken", csrftoken)
            // }
          }
        })
        .done(function(response) {

        })
        .fail(function(error) {
        });

      }
    });
  });
</script>
{% endblock %}
