{% set page_title = "Agent List" %}
{% extends "base.html" %}

{% block stylesheets %}
<style media="screen" type="text/css">
  hr {
    height:2px;
    color:white;
    margin-top: 10px;
    margin-bottom: 5px;
  }

  .center-in-center {
    width: auto;
    height: auto;
    position: absolute;
    padding: 10px 20px 0px 20px;
    left: 50%;
    background-color: white;
    -webkit-transform: translate(-50%, 0%);
    -moz-transform: translate(-50%, 0%);
    -ms-transform: translate(-50%, 0%);
    -o-transform: translate(-50%, 0%);
    transform: translate(-50%, 0%);
  }
  .input-group {
    width: 400px;
    height: 30px;
  }
  .form-control {
    height: inherit;
    font-size: 16px;
  }
  .input-group-addon {
    width: 80px;
  }
  .form-filling {
    height: 10px;
  }
  .submit {
    border-radius: 4px;
    color: #fff;
    width: 100%;
    height: 100%;
    background-color: #3B78DD;
    font-size: 20px;
  }

  .form-red {
    border: 1px solid red;
  }
</style>
{% endblock %}

{% block content %}
<div class="container">
  <label style="font-size:15px;">
    <a href="{{ url_for('agent.list') }}" style="color:black;"> 代理商列表 </a>
  </label>
  <label style="font-size:10px;float: right!important;">
    <a href="{{ url_for('agent.add_agent') }}" style="color:black;"> 代理商 </a>
  </label>
  <label class="label-header" style="font-size:10px;float: right!important;">
    <a href="{{ url_for('agent.add_contact') }}" style="color:black;"> 联系人 </a>
  </label>
  <hr>

  <div class="center-in-center">
    <form method="post" action="{{url_for('agent.add_contact')}}" id="add_form">
      <div class="input-group margin-bottom-sm">
        <span class="input-group-addon">姓名</span>
        <input class="form-control" id="name" type="text" placeholder="姓名" name="name">
      </div>
      <div class="form-filling"></div>
      <div class="input-group margin-bottom-sm">
        <span class="input-group-addon">地址</span>
        <textarea class="form-control" id="address" type="text" placeholder="地址" name=" address" form="add_form">
        </textarea>
      </div>
      <div class="form-filling"></div>
      <div class="input-group margin-bottom-sm">
        <span class="input-group-addon">电话</span>
        <input class="form-control" id="tel" ype="text" placeholder="电话" name="tel">
      </div>
      <div class="form-filling"></div>
      <div class="input-group margin-bottom-sm">
        <span class="input-group-addon">代理商</span>
        <select class="form-control" id="agent" name="agent" form="add_form">
          {% for agent in agents %}
            <option value="{{agent.name}}">{{agent.name}}</option>
          {% endfor %}
        </select>
      </div>
      <div class="form-filling"></div>
      <div class="input-group">
        <button class="submit" type="submit" name="button" value="login">提&nbsp;&nbsp交</button>
      </div>
      <div class="form-filling"></div>
    </form>
  </div>
</div>

{% endblock %}

{% block script %}
<script type=text/javascript>
  function isNull(val) {
    //去除空格
    console.log(val)
    var str = val.replace(/(^\s*)|(\s*$)/g, '');//把val首尾的空格去掉。

    //空格为 null
    if (str == '' || str == undefined || str == null) {
      console.log("true")
      return true;
    }
    return false;
  };

  function updateState(element) {
    if (isNull(element.value)) {
      element.classList.add('form-red')
      return false
    }
    element.classList.remove('form-red')
    return true
  }

  $(function () {
    $("form").submit( function(event) {
      event.preventDefault();
      var name = document.getElementById('name');
      var address = document.getElementById('address');
      var tel = document.getElementById('tel');


      var convertTableToJson = function()
      {
          var rows = {
            name: document.getElementById('name').value,
            address: document.getElementById('address').value,
            tel: document.getElementById('tel').value,
            agent: document.getElementById('agent').value,
          };
          return JSON.stringify(rows);
      };


      if (updateState(name)
      && updateState(address)
      && updateState(tel)) {
        $.ajax({
          url: $(this).attr("action"),
          type: 'post',
          dataType: "json",
          contentType: "application/json",
          data: convertTableToJson(),
          beforeSend: function(xhr, settings) {
            // if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type)) {
            //   xhr.setRequestHeader("X-CSRFToken", csrftoken)
            // }
          },
          success: function (data) {
            if (data.status = 302) {
              location.href = data.location;
            }
          }
        })
        .done(function(response) {

        })
        .fail(function(error) {
        });

      }
    });
  });
</script>
{% endblock %}
